<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Supplier Dashboard</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">

<style>
  body { background-color: #f4f6f8; }
  .nav-tabs .nav-link.active { background-color: #0d6efd; color: white; }
  .toast-container { z-index: 1055; }
</style>
</head>
<body style="font-family:'Poppins', sans-serif;">

  <nav class="navbar navbar-expand-lg navbar-light bg-body-tertiary shadow-sm">
    <div class="container-fluid">
      <a class="navbar-brand" href="#"><img src="logo1.png" alt="logo" style="width: 40px; border-radius: 40%;"></a>
      
      <!-- Toggler button -->
      <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarSupportedContent"
        aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
        <span class="navbar-toggler-icon"></span>
      </button>
  
      <div class="collapse navbar-collapse" id="navbarSupportedContent">
        <ul class="navbar-nav me-auto mb-2 mb-lg-0">
          <li class="nav-item"><a class="nav-link active" href="#">Home</a></li>
          <li class="nav-item"><a class="nav-link active" href="#">Product Requst</a></li>
          <li class="nav-item"><a class="nav-link active" href="#">SuperMarkets</a></li>
        </ul>
  
        <!-- User icon aligned right -->
        <div class="d-flex">
          <i class="bi bi-person-circle fs-2" style="color: black; cursor: pointer;"></i>
        </div>
      </div>
    </div>
  </nav>
<div class="container mt-4">
  <h2 class="text-center mb-4">Welcome, Supplier.</h2>

  <ul class="nav nav-tabs mb-3" id="dashboardTabs" role="tablist">
    <li class="nav-item" role="presentation">
      <button class="nav-link active" id="requests-tab" data-bs-toggle="tab" data-bs-target="#requests" type="button">Product Requests</button>
    </li>
    <li class="nav-item" role="presentation">
      <button class="nav-link" id="supermarkets-tab" data-bs-toggle="tab" data-bs-target="#supermarkets" type="button">Supermarkets</button>
    </li>
  </ul>

  <div class="tab-content">

    <!-- Product Requests Tab -->
    <div class="tab-pane fade show active" id="requests" role="tabpanel">

      <div class="card shadow-sm mb-4">
        <div class="card-header bg-primary text-white">Send Product Request</div>
        <div class="card-body">
          <form id="sendRequestForm" class="row g-3">
            <div class="col-md-3">
              <select class="form-select" id="supermarketSelect" required>
                <option value="">Select Supermarket</option>
              </select>
            </div>
            <div class="col-md-3">
              <input type="text" class="form-control" id="productName" placeholder="Product Name" required>
            </div>
            <div class="col-md-2">
              <input type="number" class="form-control" id="quantity" placeholder="Quantity" required>
            </div>
            <div class="col-md-2">
              <input type="number" class="form-control" id="price" placeholder="Price" required>
            </div>
            <div class="col-md-2">
              <button type="submit" class="btn btn-success w-100">Send Request</button>
            </div>
          </form>
        </div>
      </div>

      <div class="card shadow-sm mb-4">
        <div class="card-header bg-secondary text-white">Incoming Requests from Managers</div>
        <div class="card-body table-responsive">
          <table class="table table-bordered" id="incomingRequestsTable">
            <thead>
              <tr>
                <th>Manager</th>
                <th>Supermarket</th>
                <th>Product</th>
                <th>Quantity</th>
                <th>Price</th>
                <th>Total Price</th>
                <th>Actions</th>
              </tr>
            </thead>
            <tbody></tbody>
          </table>
        </div>
      </div>

      <div class="card shadow-sm mb-4">
        <div class="card-header bg-info text-white">Sent Requests to Managers</div>
        <div class="card-body table-responsive">
          <table class="table table-bordered" id="sentRequestsTable">
            <thead>
              <tr>
                <th>Supermarket</th>
                <th>Product</th>
                <th>Quantity</th>
                <th>Price</th>
                <th>Total Price</th>
                <th>Actions</th>
              </tr>
            </thead>
            <tbody></tbody>
          </table>
        </div>
      </div>

    </div>

    <!-- Supermarkets Tab -->
    <div class="tab-pane fade" id="supermarkets" role="tabpanel">

      <div class="card shadow-sm mb-4">
        <div class="card-header bg-success text-white">Add New Supermarket</div>
        <div class="card-body">
          <form id="supermarketForm" class="row g-3">
            <div class="col-md-2">
              <input type="text" class="form-control" id="supermarketName" placeholder="Supermarket Name" required>
            </div>
            <div class="col-md-3">
              <input type="email" class="form-control" id="supermarketEmail" placeholder="Email" required>
            </div>
            <div class="col-md-2">
              <input type="text" class="form-control" id="supermarketPhone" placeholder="Phone" required>
            </div>
            <div class="col-md-3">
              <input type="text" class="form-control" id="generatedCode" placeholder="Generated Code" required>
            </div>
            <div class="col-md-2">
              <button type="submit" class="btn btn-primary w-100">Add Supermarket</button>
            </div>
          </form>
        </div>
      </div>

      <div class="card shadow-sm">
        <div class="card-header bg-dark text-white">Supermarkets List</div>
        <div class="card-body table-responsive">
          <table class="table table-bordered" id="supermarketsTable">
            <thead>
              <tr>
                <th>Name</th>
                <th>Email</th>
                <th>Phone</th>
                <th>Generated Code</th>
                <th>Actions</th>
              </tr>
            </thead>
            <tbody></tbody>
          </table>
        </div>
      </div>

    </div>

  </div>
</div>

<div class="toast-container position-fixed top-0 end-0 p-3">
  <div id="liveToast" class="toast text-bg-success border-0" role="alert" aria-live="assertive" aria-atomic="true">
    <div class="d-flex">
      <div class="toast-body">Action successful!</div>
      <button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast"></button>
    </div>
  </div>
</div>


<script>
  // Data Arrays
  let incomingRequests = [];
  let sentRequests = [];
  let supermarkets = [];

  // DOM elements
  const incomingTable = document.querySelector('#incomingRequestsTable tbody');
  const sentTable = document.querySelector('#sentRequestsTable tbody');
  const superTable = document.querySelector('#supermarketsTable tbody');
  const supermarketSelect = document.querySelector('#supermarketSelect');

  // Toast function
  function showToast(message, color = 'success') {
    const toastEl = document.getElementById('liveToast');
    toastEl.className = `toast text-bg-${color} border-0`;
    toastEl.querySelector('.toast-body').innerText = message;
    const toast = new bootstrap.Toast(toastEl, { delay: 3000 });
    toast.show();
  }

  // Render Tables
  function renderTables() {
    // Incoming Requests
    incomingTable.innerHTML = '';
    if(incomingRequests.length === 0){
      incomingTable.innerHTML = `<tr><td colspan="6" class="text-center text-muted">No details</td></tr>`;
    } else {
      incomingRequests.forEach((req, i) => {
        const total = (req.quantity * req.price).toFixed(2);
        const row = document.createElement('tr');
        row.innerHTML = `
          <td>${req.manager}</td>
          <td>${req.product}</td>
          <td>${req.quantity}</td>
          <td>${req.price}</td>
          <td>${total}</td>
          <td>
            <button class="btn btn-sm btn-success me-1" onclick="confirmRequest(${i})">Confirm</button>
            <button class="btn btn-sm btn-danger" onclick="deleteIncoming(${i})">Delete</button>
          </td>`;
        incomingTable.appendChild(row);
      });
    }

    // Sent Requests
    sentTable.innerHTML = '';
    if(sentRequests.length === 0){
  sentTable.innerHTML = `<tr><td colspan="6" class="text-center text-muted">No details</td></tr>`;
} else {
  sentRequests.forEach((req, i) => {
    const total = (req.quantity * req.price).toFixed(2);
    const row = document.createElement('tr');
    row.innerHTML = `
      <td><input class="form-control form-control-sm" value="${req.supermarket}" id="sent-super-${i}"></td>
      <td><input class="form-control form-control-sm" value="${req.product}" id="sent-product-${i}"></td>
      <td><input class="form-control form-control-sm" type="number" value="${req.quantity}" id="sent-qty-${i}"></td>
      <td><input class="form-control form-control-sm" type="number" value="${req.price}" id="sent-price-${i}"></td>
      <td>${total}</td>
      <td>
        <button class="btn btn-sm btn-primary me-1" onclick="updateSentRequest(${i})">Save</button>
        <button class="btn btn-sm btn-danger" onclick="deleteSentRequest(${i})">Delete</button>
      </td>`;
    sentTable.appendChild(row);
  });
}

// Update & Delete functions for Sent Requests
function updateSentRequest(i){
  sentRequests[i].supermarket = document.getElementById(`sent-super-${i}`).value;
  sentRequests[i].product = document.getElementById(`sent-product-${i}`).value;
  sentRequests[i].quantity = parseInt(document.getElementById(`sent-qty-${i}`).value);
  sentRequests[i].price = parseFloat(document.getElementById(`sent-price-${i}`).value);
  renderTables();
  showToast('Sent request updated!');
}

function deleteSentRequest(i){
  sentRequests.splice(i, 1);
  renderTables();
  showToast('Sent request deleted!', 'danger');
}

    // Supermarkets
    superTable.innerHTML = '';
    if(supermarkets.length === 0){
      superTable.innerHTML = `<tr><td colspan="5" class="text-center text-muted">No details</td></tr>`;
    } else {
      supermarkets.forEach((sm, i) => {
        const row = document.createElement('tr');
        row.innerHTML = `
          <td><input class="form-control form-control-sm" value="${sm.name}" id="name-${i}"></td>
          <td><input class="form-control form-control-sm" value="${sm.email}" id="email-${i}"></td>
          <td><input class="form-control form-control-sm" value="${sm.phone}" id="phone-${i}"></td>
          <td><input class="form-control form-control-sm" value="${sm.code}" id="code-${i}"></td>
          <td>
            <button class="btn btn-sm btn-primary me-1" onclick="updateSupermarket(${i})">Save</button>
            <button class="btn btn-sm btn-danger" onclick="deleteSupermarket(${i})">Delete</button>
          </td>`;
        superTable.appendChild(row);
      });
    }

    // Update Select Options
    supermarketSelect.innerHTML = `<option value="">Select Supermarket</option>`;
    supermarkets.forEach(sm => {
      supermarketSelect.innerHTML += `<option value="${sm.name}">${sm.name}</option>`;
    });
  }

  // Request actions
  function confirmRequest(i) {
    incomingRequests.splice(i, 1);
    renderTables();
    showToast('Request confirmed!');
  }
  function deleteIncoming(i) {
    incomingRequests.splice(i, 1);
    renderTables();
    showToast('Request deleted!', 'danger');
  }

  // Send request
  document.getElementById('sendRequestForm').addEventListener('submit', e => {
    e.preventDefault();
    const newReq = {
      supermarket: document.getElementById('supermarketSelect').value,
      product: document.getElementById('productName').value,
      quantity: parseInt(document.getElementById('quantity').value),
      price: parseFloat(document.getElementById('price').value)
    };
    sentRequests.unshift(newReq);
    e.target.reset();
    renderTables();
    showToast('Request successfully sent!');
  });

  // Supermarket form
  document.getElementById('supermarketForm').addEventListener('submit', e => {
    e.preventDefault();
    const sm = {
      name: document.getElementById('supermarketName').value,
      email: document.getElementById('supermarketEmail').value,
      phone: document.getElementById('supermarketPhone').value,
      code: document.getElementById('generatedCode').value
    };
    supermarkets.unshift(sm);
    e.target.reset();
    renderTables();
    showToast('Supermarket added!');
  });

  // Update/Delete supermarket
  function updateSupermarket(i) {
    supermarkets[i].name = document.getElementById(`name-${i}`).value;
    supermarkets[i].email = document.getElementById(`email-${i}`).value;
    supermarkets[i].phone = document.getElementById(`phone-${i}`).value;
    supermarkets[i].code = document.getElementById(`code-${i}`).value;
    renderTables();
    showToast('Supermarket details updated!');
  }
  function deleteSupermarket(i) {
    supermarkets.splice(i, 1);
    renderTables();
    showToast('Supermarket deleted!', 'danger');
  }

  // Initial render
  renderTables();
</script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

</body>
</html>
